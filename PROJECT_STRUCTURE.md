# DUKAAN (à°¦à±à°•à°¾à°£à±) - Complete Project Structure Guide

## ğŸ“ Root Directory Overview

```
dukaan/
â”œâ”€â”€ android/              # Native Android app (Capacitor-generated)
â”œâ”€â”€ src/                  # React source code (your main app logic)
â”œâ”€â”€ public/               # Static assets served as-is
â”œâ”€â”€ node_modules/         # npm dependencies (auto-generated)
â”œâ”€â”€ dist/                 # Production build output (generated by Vite)
â”œâ”€â”€ .env                  # Environment variables (NEVER commit to git)
â”œâ”€â”€ package.json          # npm dependencies & scripts
â”œâ”€â”€ vite.config.js        # Vite bundler configuration
â”œâ”€â”€ capacitor.config.ts   # Capacitor native app configuration
â”œâ”€â”€ index.html            # App entry point
â””â”€â”€ replit.md             # Project documentation
```

---

## ğŸ“± /android - Native Android Application

**Purpose:** Contains the complete Android Studio project generated by Capacitor. This is what you build/run in Android Studio to create the APK.

### Key Files/Folders:

```
android/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ src/main/
â”‚   â”‚   â”œâ”€â”€ AndroidManifest.xml          # App permissions, activities
â”‚   â”‚   â”œâ”€â”€ assets/public/               # â­ YOUR WEB APP LIVES HERE
â”‚   â”‚   â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index-1ppv2cvc.js   # Bundled JavaScript (React app)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index-C5XWjvs2.css  # Bundled CSS
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...                  # Other assets
â”‚   â”‚   â”‚   â””â”€â”€ index.html               # Entry HTML
â”‚   â”‚   â”œâ”€â”€ java/com/dukaan/quickcommerce/
â”‚   â”‚   â”‚   â””â”€â”€ MainActivity.java        # Android app entry point
â”‚   â”‚   â””â”€â”€ res/                         # Android resources (icons, strings)
â”‚   â”œâ”€â”€ build.gradle                     # App-level build config
â”‚   â””â”€â”€ google-services.json             # Firebase Android config
â”œâ”€â”€ gradle/                              # Gradle wrapper files
â”œâ”€â”€ build.gradle                         # Project-level build config
â””â”€â”€ settings.gradle                      # Gradle project settings
```

### How It Works:
1. **Vite builds** your React app â†’ outputs to `/dist`
2. **`npx cap sync android`** copies `/dist` â†’ `/android/app/src/main/assets/public/`
3. **Android Studio builds** the native app with your web app embedded inside
4. The native WebView loads `file:///android_asset/public/index.html`

### Important Files:

**`AndroidManifest.xml`** - Defines:
- App permissions (RECORD_AUDIO, INTERNET, LOCATION, etc.)
- Main activity (MainActivity)
- Package name: `com.dukaan.quickcommerce`

**`google-services.json`** - Firebase configuration for Android
- Generated from Firebase Console
- Contains API keys, project IDs
- Used for Firebase Auth, Firestore on Android

**`build.gradle` (app-level)** - Dependencies:
- Capacitor core
- Capacitor plugins (voice-recorder)
- Firebase SDK
- Google Play Services

---

## âš›ï¸ /src - React Application Source Code

**Purpose:** Your entire web application written in React. This is where ALL your app logic lives.

```
src/
â”œâ”€â”€ features/              # Feature-based architecture
â”‚   â”œâ”€â”€ auth/              # Authentication
â”‚   â”œâ”€â”€ products/          # Product browsing & search
â”‚   â”œâ”€â”€ cart/              # Shopping cart
â”‚   â”œâ”€â”€ orders/            # Order management
â”‚   â”œâ”€â”€ address/           # Address management
â”‚   â”œâ”€â”€ profile/           # User profile
â”‚   â”œâ”€â”€ shopkeeper/        # Shopkeeper dashboard
â”‚   â””â”€â”€ rider/             # Rider dashboard
â”œâ”€â”€ contexts/              # React Context providers (global state)
â”œâ”€â”€ services/              # External service integrations
â”œâ”€â”€ utils/                 # Utility functions & helpers
â”œâ”€â”€ assets/                # Images, icons
â”œâ”€â”€ components/            # Shared UI components
â”œâ”€â”€ styles/                # Global CSS
â”œâ”€â”€ translations/          # Bilingual support (English/Telugu)
â”œâ”€â”€ firebaseConfig.js      # Firebase web configuration
â”œâ”€â”€ App.jsx                # Main React component
â””â”€â”€ main.jsx               # React app entry point
```

### ğŸ”‘ Key Folders Explained:

#### **1. /features - Feature-Based Organization**

Each feature has its own folder with related components:

**`/features/auth/`** - Login & Authentication
- `PhoneLoginUI.jsx` - Phone number + OTP login form
- `ProfileSetupScreen.jsx` - First-time user profile setup
- `AuthContext.jsx` - User authentication state management

**`/features/products/`** - Product Display & Search
- `ProductCard.jsx` - Individual product card UI
- `ProductSearch.jsx` - Search bar with AI semantic search
- `CategoryView.jsx` - Three-level category navigation (Home â†’ Subcategories â†’ Products)
- `VoiceSearchButton.jsx` - Microphone button for voice search

**`/features/cart/`** - Shopping Cart
- `CartContext.jsx` - Cart state (add/remove items, quantities)
- `Cart.jsx` - Cart display UI
- `Checkout.jsx` - Checkout flow (address selection, order placement)

**`/features/orders/`** - Order Management
- `OrderHistory.jsx` - Customer's past orders
- `OrderTracking.jsx` - Real-time order status
- Order statuses: Pending â†’ Accepted â†’ Ready for Pickup/Out for Delivery â†’ Completed/Delivered

**`/features/shopkeeper/`** - Shopkeeper Dashboard
- `ShopkeeperDashboard.jsx` - Main dashboard
- `ProductManagement.jsx` - Add/edit/delete products
- `CategoryManagement.jsx` - Manage categories & subcategories
- `OrderManagement.jsx` - View/process customer orders
- `BrandingSettings.jsx` - Upload shop logo

**`/features/rider/`** - Rider Dashboard
- `RiderDashboard.jsx` - Assigned orders list
- `RiderOrderCard.jsx` - Order card with navigation & status updates
- Google Maps integration for navigation

#### **2. /contexts - Global State Management**

React Context API for app-wide state:

**`AuthContext.jsx`** - User authentication
- Current user info (role, phone, name)
- Login/logout functions
- Role-based access control (customer/shopkeeper/rider)

**`DataContext.jsx`** - Firestore data
- Products, categories, subcategories
- Real-time sync with Firebase
- Branding settings (logo)

**`CartContext.jsx`** - Shopping cart state
- Cart items, quantities
- Add to cart, remove, clear functions

**`AddressContext.jsx`** - User addresses
- CRUD operations for addresses
- Default address selection

#### **3. /services - External Integrations**

**`gemini.js`** - Google Gemini AI Integration
- Voice transcription (audio â†’ text)
- Semantic product search
- Text translation (Telugu â†” English)
- Uses API key from `import.meta.env.VITE_GEMINI_API_KEY`

**`firebase.js`** - Firebase service functions
- Firestore queries (getProducts, getOrders, etc.)
- Authentication helpers
- Real-time listeners

#### **4. /utils - Helper Functions**

**`audioRecorder.js`** - Audio Recording
- **Native (Android/iOS):** Uses `capacitor-voice-recorder` plugin
- **Web:** Falls back to MediaRecorder API
- Handles permissions, recording start/stop, returns audio Blob

**`locationUtils.js`** - Geolocation
- Browser Geolocation API
- Reverse geocoding via OpenStreetMap Nominatim
- Converts coordinates â†’ readable address

**`orderUtils.js`** - Order number generation
- Format: `DUKAAN-YYYYMMDD-XXXX` (e.g., DUKAAN-20251108-0001)
- Daily reset counter

#### **5. /translations - Bilingual Support**

**`translations.js`** - Translation dictionary
```javascript
{
  welcome: { en: "Welcome", te: "à°¸à±à°µà°¾à°—à°¤à°‚" },
  addToCart: { en: "Add to Cart", te: "à°•à°¾à°°à±à°Ÿà±â€Œà°•à°¿ à°œà±‹à°¡à°¿à°‚à°šà°‚à°¡à°¿" }
}
```

**How it works:**
- User selects language (English/Telugu)
- All UI text uses `t('key')` function
- Products/categories have `nameEn` and `nameTe` fields

---

## ğŸ”§ Configuration Files

### **`package.json`** - npm Dependencies & Scripts
```json
{
  "scripts": {
    "dev": "vite --host 0.0.0.0 --port 5000",  // Development server
    "build": "vite build",                      // Production build
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.x",
    "firebase": "^10.x",
    "@google/genai": "AI SDK",
    "capacitor-voice-recorder": "^7.0.6",
    // ... more
  }
}
```

**Key Scripts:**
- `npm run dev` - Start dev server at http://0.0.0.0:5000
- `npm run build` - Build for production â†’ outputs to `/dist`
- `npx cap sync android` - Copy build to Android folder

### **`vite.config.js`** - Vite Bundler Config
```javascript
export default defineConfig({
  plugins: [react()],
  server: {
    host: '0.0.0.0',      // Allow external connections
    port: 5000,           // MUST be 5000 for Replit
    allowedHosts: true    // Required for Replit iframe
  }
})
```

**CRITICAL:** 
- Port MUST be 5000 (only exposed port on Replit)
- `allowedHosts: true` required for iframe proxy

### **`capacitor.config.ts`** - Native App Config
```typescript
{
  appId: 'com.dukaan.quickcommerce',
  appName: 'DUKAAN',
  webDir: 'dist',  // Where Vite outputs the build
  server: {
    androidScheme: 'https'  // Use HTTPS scheme for Android
  }
}
```

### **`.env`** - Environment Variables
```
VITE_GEMINI_API_KEY=AIzaSyAVBBw2bRGN8JUjZZyfjYIScdpwv6pGx9c
```

**âš ï¸ CRITICAL BUILD ISSUE:**
- Vite doesn't reliably load `.env` during `npm run build`
- **Solution:** Use inline env var:
  ```bash
  VITE_GEMINI_API_KEY="your_key" npm run build
  ```

### **`firebaseConfig.js`** - Firebase Web Config
```javascript
export const firebaseConfig = {
  apiKey: "AIzaSyAWRYzgUdSBHcBLKJoVFs0M-r2bI7AYD1s",
  authDomain: "dukaan-476221.firebaseapp.com",
  projectId: "dukaan-476221",
  // ...
};
```

**Two separate Firebase configs:**
1. **Web:** `src/firebaseConfig.js` (JavaScript object)
2. **Android:** `android/app/google-services.json` (JSON file)

---

## ğŸ”„ Development Workflow

### **Local Development (Web)**
```bash
# 1. Install dependencies
npm install

# 2. Start dev server
npm run dev

# 3. Open browser
http://localhost:5000
```

### **Build for Android**
```bash
# 1. Build web app with API key
VITE_GEMINI_API_KEY="your_key" npm run build

# 2. Sync to Android
npx cap sync android

# 3. Open in Android Studio
npx cap open android

# 4. In Android Studio:
#    - File â†’ Sync Project with Gradle Files (ğŸ˜ elephant icon)
#    - Build â†’ Clean Project
#    - Build â†’ Make Project
#    - Click â–¶ï¸ Run
```

---

## ğŸ—„ï¸ Firebase Database Structure

### Firestore Collections:

**`users/{userId}`**
```json
{
  "phone": "+919876543210",
  "name": "à°°à°¾à°®à±",
  "role": "customer",  // customer | shopkeeper | rider
  "preferredLanguage": "te",
  "createdAt": timestamp
}
```

**`products/{productId}`**
```json
{
  "nameEn": "Rice",
  "nameTe": "à°¬à°¿à°¯à±à°¯à°‚",
  "price": 60,
  "category": "groceries",
  "subcategory": "grains",
  "imageUrl": "https://...",
  "inStock": true,
  "isPopular": false,
  "sortOrder": 1
}
```

**`orders/{orderId}`**
```json
{
  "orderNumber": "DUKAAN-20251108-0001",
  "userId": "user123",
  "items": [{productId, quantity, price, nameEn, nameTe}],
  "total": 500,
  "status": "pending",  // pending | accepted | ready_for_pickup | out_for_delivery | completed | delivered
  "deliveryMethod": "delivery",  // delivery | pickup
  "address": {...},
  "customerLanguage": "te",
  "createdAt": timestamp
}
```

**`categories/{categoryId}`**
```json
{
  "nameEn": "Groceries",
  "nameTe": "à°•à°¿à°°à°¾à°£à°¾",
  "sortOrder": 1
}
```

**`subcategories/{subcategoryId}`**
```json
{
  "nameEn": "Grains",
  "nameTe": "à°§à°¾à°¨à±à°¯à°¾à°²à±",
  "categoryId": "groceries",
  "sortOrder": 1
}
```

---

## ğŸš€ Build & Deploy Summary

### **Web Version (Replit)**
- Runs on `https://your-repl.replit.app`
- Uses Firebase web SDK
- Works in any browser

### **Android Version (APK)**
- Built in Android Studio
- Embedded web app runs in Capacitor WebView
- Native features: voice recorder, GPS navigation
- Firebase Android SDK via `google-services.json`

### **Critical Build Command**
```bash
# Use this script (build-android.sh) to rebuild Android app:
VITE_GEMINI_API_KEY="AIzaSyAVBBw2bRGN8JUjZZyfjYIScdpwv6pGx9c" npm run build && npx cap sync android
```

---

## ğŸ› Common Issues

### **1. "API key missing" in Android**
- Cause: `.env` not loaded during build
- Fix: Use inline env var in build command (see above)

### **2. "VoiceRecorder not implemented"**
- Cause: Gradle not synced after `cap sync`
- Fix: Click ğŸ˜ elephant icon in Android Studio

### **3. Blank screen in Android**
- Cause: Build output not synced
- Fix: `npm run build && npx cap sync android`

### **4. Changes not visible on Replit**
- Cause: Workflow not restarted
- Fix: Restart "Server" workflow

---

## ğŸ“¦ What Gets Built Where

```
npm run build
â””â”€â”€ Creates /dist/
    â”œâ”€â”€ index.html
    â”œâ”€â”€ assets/
    â”‚   â”œâ”€â”€ index-1ppv2cvc.js  â† Your entire React app
    â”‚   â””â”€â”€ index-C5XWjvs2.css

npx cap sync android
â””â”€â”€ Copies /dist/ â†’ /android/app/src/main/assets/public/

Android Studio builds APK
â””â”€â”€ Packages public/ folder into APK
```

---

## ğŸ¯ Key Takeaways

1. **Your main code:** `/src` (React app)
2. **Android native:** `/android` (auto-generated, rarely touch)
3. **Build output:** `/dist` (auto-generated, gets synced to Android)
4. **Environment vars:** Use inline for builds: `VITE_GEMINI_API_KEY="key" npm run build`
5. **Always sync:** After building, run `npx cap sync android`
6. **Always Gradle sync:** Click ğŸ˜ in Android Studio after sync

**The app is a single React codebase that runs:**
- As a website (Vite dev server)
- Inside Android WebView (Capacitor)
- With native plugins for Android-only features (voice, GPS)

