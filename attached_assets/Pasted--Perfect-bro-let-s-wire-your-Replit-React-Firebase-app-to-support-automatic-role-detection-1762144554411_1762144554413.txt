ğŸ”¥ Perfect bro â€” letâ€™s wire your **Replit React + Firebase app** to support automatic role detection (customer/shopkeeper/rider).

Youâ€™ll just make a few additions â€” everything else (OTP, Firebase Auth) stays the same.

Hereâ€™s the **exact instruction set** you can follow or paste into your `README` or directly apply inside your Replit code.

---

## âš™ï¸ GOAL:

After login via OTP, your app:

1. Automatically creates a Firestore document if user is new.
2. Reads userâ€™s `role` field from Firestore.
3. Navigates to the correct dashboard:

   * Customer â†’ `/customer/home`
   * Shopkeeper â†’ `/shop/dashboard`
   * Rider â†’ `/rider/orders`

---

## ğŸ§© Step-by-Step â€” Firebase Role Integration in Replit

### 1ï¸âƒ£ Ensure Firebase SDK is imported correctly

In your Replit `src/firebase.js` (or similar file), make sure it looks like this:

```js
// firebase.js
import { initializeApp } from "firebase/app";
import { getAuth } from "firebase/auth";
import { getFirestore } from "firebase/firestore";

const firebaseConfig = {
  apiKey: "YOUR_FIREBASE_API_KEY",
  authDomain: "dukaan-476221.firebaseapp.com",
  projectId: "dukaan-476221",
  storageBucket: "dukaan-476221.appspot.com",
  messagingSenderId: "344365593313",
  appId: "1:344365593313:web:d88144fd18f79052bcbda0"
};

const app = initializeApp(firebaseConfig);
export const auth = getAuth(app);
export const db = getFirestore(app);
```

âœ… Youâ€™re already using this for OTP â€” so just confirm both `auth` and `db` are exported.

---

### 2ï¸âƒ£ Add role creation logic after OTP success

Locate the part where your OTP verification finishes (for example in `Login.js` or `AuthPage.js`):

Itâ€™ll look like:

```js
const user = result.user;
console.log("User signed in:", user);
```

Right **after** that line, add this â¬‡ï¸

```js
import { doc, getDoc, setDoc, serverTimestamp } from "firebase/firestore";
import { db } from "../firebase";  // adjust import path if needed

const userDocRef = doc(db, "users", user.uid);
const userSnap = await getDoc(userDocRef);

if (!userSnap.exists()) {
  // create default user entry
  await setDoc(userDocRef, {
    name: user.displayName || "",
    phone: user.phoneNumber,
    role: "customer",  // default for new users
    createdAt: serverTimestamp(),
  });
}
```

âœ… This ensures every first-time login creates a record like:

```json
/users/uid123
{
  "phone": "+919876543210",
  "role": "customer"
}
```

---

### 3ï¸âƒ£ Detect role after login and route correctly

Right after that block, add:

```js
const userData = (await getDoc(userDocRef)).data();

if (userData.role === "customer") {
  navigate("/customer/home");
} else if (userData.role === "shopkeeper") {
  navigate("/shop/dashboard");
} else if (userData.role === "rider") {
  navigate("/rider/orders");
}
```

âœ… This redirects users automatically based on their Firestore role.

---

### 4ï¸âƒ£ Add shopkeepers and riders manually (admin step)

Open Firebase Console â†’ Firestore Database â†’ â€œusersâ€ collection.
Click **Add Document** â†’ paste manually:

#### Shopkeeper example:

```json
{
  "name": "Meena Store",
  "phone": "+919874563210",
  "role": "shopkeeper"
}
```

#### Rider example:

```json
{
  "name": "Suresh Rider",
  "phone": "+919875551212",
  "role": "rider"
}
```

âœ… When these phone numbers log in, theyâ€™ll be automatically routed to their correct dashboards.

---

### 5ï¸âƒ£ (Optional) Add a loading spinner during detection

While fetching Firestore doc, you can show a â€œLoading...â€ message:

```js
setLoading(true);
const userDoc = await getDoc(userDocRef);
setLoading(false);
```

---

### 6ï¸âƒ£ Secure your Firestore (basic rules)

In Firebase â†’ Firestore â†’ Rules, add:

```js
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /users/{userId} {
      allow read, write: if request.auth.uid == userId;
    }

    match /orders/{orderId} {
      allow read, write: if
        request.auth != null &&
        (
          resource.data.customerId == request.auth.uid ||
          resource.data.shopId == request.auth.uid ||
          resource.data.riderId == request.auth.uid
        );
    }
  }
}
```

âœ… This ensures:

* Users canâ€™t modify other users.
* Riders/customers/shopkeepers can only read their orders.

---

## ğŸ§± Folder Layout Suggestion

```
src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ customer/
â”‚   â”‚   â”œâ”€â”€ Home.js
â”‚   â”‚   â”œâ”€â”€ Cart.js
â”‚   â”œâ”€â”€ shop/
â”‚   â”‚   â”œâ”€â”€ Dashboard.js
â”‚   â”‚   â”œâ”€â”€ Orders.js
â”‚   â”œâ”€â”€ rider/
â”‚   â”‚   â”œâ”€â”€ ActiveOrders.js
â”‚   â”‚   â”œâ”€â”€ History.js
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ Login.js
â”‚   â”‚   â”œâ”€â”€ VerifyOTP.js
â”‚
â”œâ”€â”€ firebase.js
â”œâ”€â”€ App.js
```

Then in `App.js`, keep routes simple:

```js
<Route path="/customer/*" element={<CustomerHome />} />
<Route path="/shop/*" element={<ShopDashboard />} />
<Route path="/rider/*" element={<RiderDashboard />} />
```

---

### âœ… Summary of Instructions for Replit

| Step | What to Do                          | File             |
| ---- | ----------------------------------- | ---------------- |
| 1ï¸âƒ£  | Export `auth` + `db`                | `firebase.js`    |
| 2ï¸âƒ£  | Create Firestore user doc after OTP | `Login.js`       |
| 3ï¸âƒ£  | Route user based on role            | `Login.js`       |
| 4ï¸âƒ£  | Manually add shopkeepers/riders     | Firebase Console |
| 5ï¸âƒ£  | Protect data with rules             | Firestore Rules  |
| 6ï¸âƒ£  | Add routes for each role            | `App.js`         |

---

If you want, I can directly generate your **ready-to-paste Replit `Login.js` file** (with OTP + Firestore + auto-role redirect integrated).
Do you want me to generate that next?
